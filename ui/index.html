<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>SeNARS UI2</title>
    <link href="style.css" rel="stylesheet">
    <script type="importmap">
        {
            "imports": {
                "@senars/core": "/core/src/browser.js",
                "@senars/agent": "/agent/src/browser.js"
            }
        }
    </script>
</head>

<body>
    <div class="app-container">
        <!-- REPL Panel (Main View) -->
        <div class="log-panel" id="main-panel">
            <div class="panel-header">
                <span>SeNARS Control</span>
                <div class="control-toolbar">
                    <button class="icon-btn" id="btn-play-pause" title="Play/Pause">‚ñ∂</button>
                    <button class="icon-btn" id="btn-step" title="Single Step">‚èØ</button>
                    <button class="icon-btn" id="btn-reset" title="Reset System">üîÑ</button>
                    <div class="divider"></div>
                    <button class="icon-btn" id="btn-toggle-sidebar" title="Toggle Graph Sidebar">üìä</button>
                </div>
            </div>

            <div class="status-bar">
                <div class="status-item">
                    <div class="status-indicator status-disconnected" id="status-indicator"></div>
                    <span id="connection-status">Disconnected</span>
                </div>
                <div class="status-item">
                    <span class="cycle-badge" id="cycle-count">Cycle: 0</span>
                    <span class="divider">|</span>
                    <span id="message-count">0</span> msgs
                </div>
                <div class="view-toggles">
                    <button id="btn-toggle-trace" title="Toggle Log/Trace View">Show Trace</button>
                    <button id="btn-toggle-contrast" title="Toggle High-Contrast Mode">High Contrast</button>
                </div>
            </div>

            <div class="main-content-area">
                <div class="view-layer active" id="log-view-container">
                    <div class="logs-container" id="logs-container"></div>
                </div>
                <div class="view-layer hidden" id="trace-view-container">
                    <div class="trace-container" id="trace-panel"></div>
                </div>
            </div>

            <div class="input-section">
                <div class="input-mode-toggle">
                    <label class="mode-option"><input checked id="mode-narsese" name="input-mode" type="radio"
                            value="narsese"> Narsese</label>
                    <label class="mode-option"><input id="mode-agent" name="input-mode" type="radio" value="agent">
                        Agent</label>
                </div>
                <div class="input-group">
                    <input autocomplete="off" id="command-input" placeholder="Enter Narsese command..." type="text">
                    <button id="send-button">Send</button>
                </div>
                <div class="input-group">
                    <select id="quick-commands">
                        <option value="">Quick Commands...</option>
                        <option value="&lt;cat --&gt; animal&gt; .">Basic Assertion</option>
                        <option value="&lt;bird --&gt; flyer&gt; . %1.0;0.9%">Assertion with Truth Value</option>
                        <option value="&lt;dog --&gt; pet&gt; ?">Question</option>
                        <option value="&lt;(cat & dog) --&gt; pets&gt; .">Compound Term</option>
                        <option value="&lt;swan --&gt; flyer&gt; !">Goal</option>
                        <option value="*step">Single Step</option>
                        <option value="*run">Run Continuous</option>
                        <option value="*stop">Stop</option>
                        <option value="*reset">Reset</option>
                    </select>
                    <button id="exec-quick">Execute</button>
                    <button id="show-history">History</button>
                    <button id="clear-logs">Clear</button>
                </div>
            </div>
        </div>

        <!-- Graph Panel (Sidebar) -->
        <div class="graph-panel hidden" id="sidebar-panel">
            <div class="panel-header">
                <span>Graph View</span>
                <button class="icon-btn" id="btn-close-sidebar" title="Close Sidebar">√ó</button>
            </div>

            <div class="metrics-container" id="metrics-panel"></div>

            <div class="cytoscape-container" id="graph-container"></div>
            <div class="graph-controls">
                <button id="refresh-graph" title="Refresh Graph">üîÑ Graph</button>
                <button id="toggle-live" title="Toggle Live Updates">üì° Live</button>
                <div class="separator"></div>
                <button id="btn-zoom-in" title="Zoom In">‚ûï</button>
                <button id="btn-zoom-out" title="Zoom Out">‚ûñ</button>
                <button id="btn-fit" title="Fit to Screen">‚¨ú</button>
                <div class="separator"></div>
                <button id="btn-save" title="Save State">üíæ Save</button>
                <button id="btn-load" title="Load State">üìÇ Load</button>
                <div class="separator"></div>
                <label class="checkbox-control" title="Show/Hide Tasks">
                    <input checked id="show-tasks-toggle" type="checkbox"> Tasks
                </label>
            </div>

            <div class="panel-section-header">Examples</div>
            <div id="example-browser-container" class="example-browser-container"></div>

            <div class="panel-section-header">Details</div>
            <div class="graph-details-panel" id="graph-details">
                Click on nodes or edges to see details
            </div>
        </div>
    </div>

    <div class="notification-container" id="notification-container"></div>

    <!-- Confirmation Modal -->
    <div class="modal hidden" id="confirmation-modal">
        <div class="modal-content">
            <h3>Confirm Reset</h3>
            <p>Are you sure you want to reset the system? This cannot be undone.</p>
            <div class="modal-buttons">
                <button class="primary-btn" id="btn-confirm-reset">Yes, Reset</button>
                <button class="secondary-btn" id="btn-cancel-reset">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Inject WebSocket configuration from server
        window.WEBSOCKET_CONFIG = {
            port: '{{WEBSOCKET_PORT}}',
            host: window.location.hostname || 'localhost'
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.25.0/cytoscape.min.js"></script>
    <script src="https://unpkg.com/layout-base/layout-base.js"></script>
    <script src="https://unpkg.com/cose-base/cose-base.js"></script>
    <script src="https://unpkg.com/cytoscape-fcose/cytoscape-fcose.js"></script>
    <script type="module">
        import { SeNARSUI } from './src/SeNARSUI.js';
        document.addEventListener('DOMContentLoaded', () => new SeNARSUI());
    </script>
</body>

</html>