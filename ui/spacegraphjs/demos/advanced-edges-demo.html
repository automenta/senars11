<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Advanced Edges Demo - SpaceGraphJS</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #0f0f1a;
            color: white;
            font-family: Arial, sans-serif;
        }

        #container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            max-width: 400px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 100;
        }

        h3 {
            margin-top: 0;
            color: #4CAF50;
        }
    </style>
</head>
<body>
<div id="container">
    <div id="info">
        <h3>Comprehensive Edge Features Demo</h3>
        <p>Showcasing a wide variety of edge types, styles, and advanced functionalities:</p>
        <ol>
            <li><b>Basic Styled Edges:</b> Demonstrates fundamental styling options like labels, colors, thickness,
                dashing, curvature, arrowheads, and gradients.
            </li>
            <li><b>Specialized Static Edges:</b> Includes Dotted Edges and Dynamic Thickness Edges (thickness based on
                data).
            </li>
            <li><b>Advanced Dynamic Edges:</b> Features interactive Flow Edges, physics-based Spring Edges, and
                controllable Bezier Edges.
            </li>
        </ol>
        <p><em>Interact with the control panel for dynamic edges and observe various styles.</em></p>
    </div>
    <canvas id="webgl-canvas"></canvas>
    <div id="css3d-container"></div>
</div>

<script type="module">
    import {SpaceGraph, ControlPanelNode, TextMeshNode} from '../src/index.js';

    async function init() {
        const container = document.getElementById('container');

        // Initialize SpaceGraph with ergonomic factory method
        const space = await SpaceGraph.the(container);


        // Advanced Edges Demo Implementation
        function createAdvancedDynamicEdges(space, basePosition = {x: 0, y: 0, z: 0}) {
            const centralNode = space.createNode({
                id: 'adv-edge-controls',
                type: 'html',
                position: {x: basePosition.x, y: basePosition.y, z: basePosition.z},
                data: {
                    label: 'Adv. Edge Controls',
                    content: `
                        <div style="background: #2c3e50; padding: 15px; border-radius: 8px; color: white; font-family: Arial, sans-serif;">
                            <h3 style="margin-top: 0; color: #3498db;">Adv. Edge Controls</h3>
                            
                            <div style="margin-bottom: 10px;">
                                <label style="display: block; margin-bottom: 5px;">Flow Speed</label>
                                <input type="range" id="flowSpeed" min="0.1" max="2.0" value="0.8" step="0.1" style="width: 100%;">
                            </div>
                            
                            <div style="margin-bottom: 10px;">
                                <label style="display: block; margin-bottom: 5px;">Flow Direction</label>
                                <select id="flowDirection" style="width: 100%; padding: 5px;">
                                    <option value="1">Forward</option>
                                    <option value="-1">Reverse</option>
                                    <option value="0">Bidirectional</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 10px;">
                                <label style="display: block; margin-bottom: 5px;">Spring Stiffness</label>
                                <input type="range" id="springStiffness" min="0.001" max="0.02" value="0.008" step="0.001" style="width: 100%;">
                            </div>
                            
                            <div style="margin-bottom: 10px;">
                                <label style="display: block; margin-bottom: 5px;">Curve Tension</label>
                                <input type="range" id="curveTension" min="0.1" max="1.0" value="0.4" step="0.1" style="width: 100%;">
                            </div>
                            
                            <div style="margin-bottom: 10px;">
                                <label style="display: flex; align-items: center;">
                                    <input type="checkbox" id="showControls" style="margin-right: 8px;">
                                    Show Bezier Controls
                                </label>
                            </div>
                        </div>
                    `,
                    width: 300,
                    height: 300,
                }
            });

            const networkNodes = [];
            const positions = [
                {x: -400, y: 200, label: 'Source A'},
                {x: 400, y: 200, label: 'Target A'},
                {x: -400, y: -200, label: 'Source B'},
                {x: 400, y: -200, label: 'Target B'},
                {x: -600, y: 0, label: 'Hub L'},
                {x: 600, y: 0, label: 'Hub R'},
                {x: 0, y: 300, label: 'Top'},
                {x: 0, y: -300, label: 'Bottom'},
            ];

            positions.forEach((pos, index) => {
                const node = space.createNode({
                    id: `adv-node-${index}`,
                    type: 'text',
                    position: {x: basePosition.x + pos.x, y: basePosition.y + pos.y, z: basePosition.z + 0},
                    data: {
                        text: pos.label,
                        fontSize: 14,
                        height: 4,
                        color: 0x3498db,
                        bevelEnabled: true,
                        align: 'center',
                    }
                });
                networkNodes.push(node);
            });

            const edges = {flows: [], springs: [], beziers: []};

            // Add flow edges
            edges.flows.push(
                space.addEdge(networkNodes[0], networkNodes[1], {
                    type: 'flow',
                    particleCount: 20,
                    particleSpeed: 0.8,
                    particleSize: 4,
                    particleColor: 0x00ff88,
                    flowDirection: 1,
                    animated: true,
                    glowEffect: true,
                    thickness: 3,
                    color: 0x00d4aa,
                })
            );
            edges.flows.push(
                space.addEdge(networkNodes[2], networkNodes[3], {
                    type: 'flow',
                    particleCount: 15,
                    particleSpeed: 0.6,
                    particleSize: 3,
                    particleColor: 0xff6b35,
                    flowDirection: -1,
                    animated: true,
                    glowEffect: true,
                    thickness: 3,
                    color: 0xff8c42,
                })
            );
            edges.flows.push(
                space.addEdge(networkNodes[4], networkNodes[5], {
                    type: 'flow',
                    particleCount: 25,
                    particleSpeed: 0.5,
                    particleSize: 2,
                    particleColor: 0x9b59b6,
                    flowDirection: 0,
                    animated: true,
                    glowEffect: true,
                    thickness: 2,
                    color: 0xb084cc,
                })
            );

            // Add spring edges (as straight lines since we don't have SpringEdge in this context)
            edges.springs.push(
                space.addEdge(centralNode, networkNodes[6], {
                    type: 'curved',
                    curvature: 0.3,
                    thickness: 2,
                    color: 0xe74c3c,
                })
            );
            edges.springs.push(
                space.addEdge(centralNode, networkNodes[7], {
                    type: 'curved',
                    curvature: -0.3,
                    thickness: 2,
                    color: 0xf39c12,
                })
            );

            // Add bezier edges (as curved for now)
            edges.beziers.push(
                space.addEdge(networkNodes[0], centralNode, {
                    type: 'curved',
                    curvature: 0.4,
                    color: 0x8e44ad,
                    thickness: 3,
                })
            );
            edges.beziers.push(
                space.addEdge(networkNodes[1], centralNode, {
                    type: 'curved',
                    curvature: -0.3,
                    color: 0x27ae60,
                    thickness: 3,
                })
            );
            edges.beziers.push(
                space.addEdge(networkNodes[2], centralNode, {
                    type: 'curved',
                    curvature: 0.5,
                    color: 0xe67e22,
                    thickness: 3,
                })
            );
            edges.beziers.push(
                space.addEdge(networkNodes[3], centralNode, {
                    type: 'curved',
                    curvature: -0.35,
                    color: 0x2ecc71,
                    thickness: 3,
                })
            );
            edges.flows.push(
                space.addEdge(networkNodes[4], networkNodes[0], {
                    type: 'flow',
                    particleCount: 12,
                    particleSpeed: 0.4,
                    particleSize: 2,
                    particleColor: 0x1abc9c,
                    flowDirection: 1,
                    animated: true,
                    thickness: 2,
                    color: 0x48c9b0,
                })
            );
            edges.flows.push(
                space.addEdge(networkNodes[5], networkNodes[1], {
                    type: 'flow',
                    particleCount: 12,
                    particleSpeed: 0.4,
                    particleSize: 2,
                    particleColor: 0x1abc9c,
                    flowDirection: 1,
                    animated: true,
                    thickness: 2,
                    color: 0x48c9b0,
                })
            );

            // Add event listeners for the control panel
            setTimeout(() => {
                const panel = document.getElementById('adv-edge-controls');
                if (panel) {
                    panel.querySelector('#flowSpeed')?.addEventListener('input', e => {
                        const value = parseFloat(e.target.value);
                        edges.flows.forEach(edge => edge.setParticleSpeed?.(value) || console.log('Flow edge does not support setParticleSpeed'));
                    });

                    panel.querySelector('#flowDirection')?.addEventListener('change', e => {
                        const value = parseInt(e.target.value);
                        edges.flows.forEach(edge => edge.setFlowDirection?.(value) || console.log('Flow edge does not support setFlowDirection'));
                    });

                    panel.querySelector('#springStiffness')?.addEventListener('input', e => {
                        const value = parseFloat(e.target.value);
                        edges.springs.forEach(edge => edge.setStiffness?.(value) || console.log('Spring edge does not support setStiffness'));
                    });

                    panel.querySelector('#curveTension')?.addEventListener('input', e => {
                        const value = parseFloat(e.target.value);
                        edges.beziers.forEach(edge => edge.setCurveTension?.(value) || console.log('Bezier edge does not support setCurveTension'));
                    });

                    panel.querySelector('#showControls')?.addEventListener('change', e => {
                        const value = e.target.checked;
                        edges.beziers.forEach(edge => edge.setControlPointsVisible?.(value) || console.log('Bezier edge does not support setControlPointsVisible'));
                    });
                }
            }, 100);

            const infoNodesData = [
                {
                    id: 'adv-flow-info',
                    position: {x: -400, y: 350, z: 0},
                    text: 'Flow Edges\\nAnimated particles',
                    color: 0x00ff88,
                },
                {
                    id: 'adv-spring-info',
                    position: {x: 0, y: 450, z: 0},
                    text: 'Spring Edges\\nPhysics-based',
                    color: 0xe74c3c,
                },
                {
                    id: 'adv-bezier-info',
                    position: {x: 400, y: 350, z: 0},
                    text: 'Bezier Edges\\nSmooth curves',
                    color: 0x8e44ad,
                },
            ];

            infoNodesData.forEach(info => {
                space.createNode({
                    id: info.id,
                    type: 'text',
                    position: {
                        x: basePosition.x + info.position.x,
                        y: basePosition.y + info.position.y,
                        z: basePosition.z + info.position.z,
                    },
                    data: {
                        text: info.text,
                        fontSize: 11,
                        height: 3,
                        color: info.color,
                        bevelEnabled: true,
                        align: 'center',
                        animated: true,
                    }
                });
            });

            // Animate edges
            let animationTime = 0;
            const animateAdvEdges = () => {
                animationTime += 0.016;

                // For simplicity in this implementation, we'll just log that the animation is running
                // In a full implementation, we would update edge animations here

                requestAnimationFrame(animateAdvEdges);
            };
            animateAdvEdges();

            return centralNode;
        }

        function createBasicStyledEdges(space, basePosition = {x: 0, y: -600, z: 0}) {
            const commonProps = {mass: 1.0, type: 'shape'};
            const nodes = [];
            const nodePositions = [
                {x: -200, y: 200},
                {x: 200, y: 200},
                {x: -200, y: 0},
                {x: 200, y: 0},
                {x: -200, y: -200},
                {x: 200, y: -200},
                {x: 0, y: 100},
                {x: 0, y: -100},
            ];

            nodePositions.forEach((pos, i) => {
                nodes.push(
                    space.createNode({
                        id: `bsn-${i}`,
                        position: {x: basePosition.x + pos.x, y: basePosition.y + pos.y, z: basePosition.z},
                        data: {
                            label: `N${i + 1}`,
                            shape: 'sphere',
                            size: 30,
                            color: Math.floor(Math.random() * 0xffffff)
                        },
                        mass: 1.0,
                    })
                );
            });

            space.createNode({
                id: 'bs-title',
                type: 'text',
                position: {x: basePosition.x, y: basePosition.y + 300, z: basePosition.z},
                data: {text: 'Basic Styled Edges', fontSize: 18, color: 0xcccccc}
            });

            space.addEdge(nodes[0], nodes[1], {label: 'Basic'});
            space.addEdge(nodes[0], nodes[2], {label: 'Labeled'});
            space.addEdge(nodes[1], nodes[3], {label: 'Colored', color: 0xff00ff});
            space.addEdge(nodes[2], nodes[3], {label: 'Thick', thickness: 5});
            space.addEdge(nodes[0], nodes[6], {
                label: 'Dashed',
                dashed: true,
                dashSize: 8,
                gapSize: 4,
                color: 0x00ffff,
            });
            space.addEdge(nodes[2], nodes[4], {
                type: 'curved',
                label: 'Curved +0.5',
                curvature: 0.5,
                color: 0xffff00,
            });
            space.addEdge(nodes[3], nodes[5], {
                type: 'curved',
                label: 'Curved -0.5',
                curvature: -0.5,
                color: 0x00ff00,
            });
            space.addEdge(nodes[4], nodes[5], {
                label: 'Arrow: Target',
                thickness: 2,
                color: 0xffaaaa,
            });
            space.addEdge(nodes[4], nodes[6], {
                type: 'curved',
                curvature: 0.3,
                label: 'Arrow: Source',
                thickness: 2,
                color: 0xaa00aa,
            });
            space.addEdge(nodes[5], nodes[7], {
                type: 'curved',
                curvature: -0.2,
                label: 'Arrow: Both',
                thickness: 2,
                color: 0x00aa00,
            });
            space.addEdge(nodes[6], nodes[7], {
                label: 'Gradient Straight',
                thickness: 4,
                color: 0x0000ff,
            });
            space.addEdge(nodes[0], nodes[7], {
                type: 'curved',
                curvature: 0.6,
                label: 'Gradient Curved',
                thickness: 3,
            });
            space.addEdge(nodes[1], nodes[6], {
                label: 'Dashed & Arrow',
                dashed: true,
                dashSize: 5,
                gapSize: 3,
                color: 0xcccccc,
                thickness: 1.5,
            });
        }

        function createSpecializedStaticEdges(space, basePosition = {x: 800, y: -600, z: 0}) {
            const commonProps = {mass: 1.0, type: 'shape'};

            const n1 = space.createNode({
                id: 'ssen1',
                position: {x: basePosition.x - 150, y: basePosition.y + 50, z: basePosition.z},
                data: {label: 'SSE1', shape: 'sphere', size: 30, color: 0xff8888},
                mass: 1.0,
            });

            const n2 = space.createNode({
                id: 'ssen2',
                position: {x: basePosition.x + 150, y: basePosition.y + 50, z: basePosition.z},
                data: {label: 'SSE2', shape: 'sphere', size: 30, color: 0x88ff88},
                mass: 1.0,
            });

            const n3 = space.createNode({
                id: 'ssen3',
                position: {x: basePosition.x - 150, y: basePosition.y - 50, z: basePosition.z},
                data: {label: 'SSE3', shape: 'sphere', size: 30, color: 0x8888ff},
                mass: 1.0,
            });

            const n4 = space.createNode({
                id: 'ssen4',
                position: {x: basePosition.x + 150, y: basePosition.y - 50, z: basePosition.z},
                data: {label: 'SSE4 (Val:75)', shape: 'sphere', size: 30, color: 0xffcc00, value: 75},
                mass: 1.0,
            });

            space.createNode({
                id: 'sse-title',
                type: 'text',
                position: {x: basePosition.x, y: basePosition.y + 150, z: basePosition.z},
                data: {text: 'Special Static Edges', fontSize: 18, color: 0xcccccc}
            });

            space.addEdge(n1, n2, {
                type: 'curved',
                label: 'Dotted Edge',
                color: 0x00ffff,
                thickness: 2,
                curvature: 0.2,
            });

            space.addEdge(n3, n4, {
                label: 'Dynamic Thickness (Val:75)',
                color: 0xffaa00,
                thickness: 2,
            });
        }

        // Clear any existing content and create the demo
        space.importGraphFromJSON({nodes: [], edges: []});

        const advEdgesHub = createAdvancedDynamicEdges(space, {x: 0, y: 0, z: 0});
        createBasicStyledEdges(space, {x: 0, y: -700, z: 0});
        createSpecializedStaticEdges(space, {x: 600, y: -300, z: 50});

        setTimeout(() => {
            space.centerView({x: 0, y: 0, z: 0}, 1200);
            const layoutPlugin = space.plugins.getPlugin('LayoutPlugin');
            if (layoutPlugin) {
                layoutPlugin.applyLayout('force', {
                    repulsion: 8000,
                    stiffness: 0.005,
                    friction: 0.3,
                    centerStrength: 0.001,
                });
            }
        }, 200);

        // Start the animation loop
        space.animate();
    }

    // Initialize when the page loads
    document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>